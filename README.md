# 113-1 資料庫管理 - QQbeat 專案範例

## 專案簡介

本專案旨在設計與開發 QQbeat，一個現代化的線上音樂串流平台，專為音樂愛好者打造，提供便捷的音樂探索與享受體驗

## 使用者功能

### User （一般使用者）

#### 使用者登入、註冊

- 註冊：使用者可以註冊帳號設定使用者名稱、密碼及電子郵件信箱，系統會分配一個 user_id 給每位使用者。
- 登入：使用系統分配的 user_id 登入並驗證密碼。

#### 瀏覽音樂庫

- 使用者可依據分類（曲名、歌手、專輯等）搜尋音樂並查看相關資訊

#### 查看音樂合輯

- 使用者可已透過查詢功能或系統推薦來瀏覽各種音樂合輯，其中包括自己的播放清單、每周排行榜、個人化推薦合輯、其他人建立的公開播放清單。

#### 創建/修改/刪除播放清單

#### 加入、調整、移除歌曲至播放清單

### Admin （管理員／業務經營者）

除了上述 User 擁有的功能以外，還增加以下功能：

#### 管理音樂

- 新增、更新、刪除音樂曲目，並管理歌手、專輯等資料

#### 建立/修改合輯

#### 更改使用者權限

#### 查詢使用者播放紀錄

## 使用方法

- 使用備份檔 `QQbeat_backup` 復原資料庫
- 預設連線通道為 **127.0.0.1:8800**，可至 `server.py` 及 `client.py` 修改
- 在 `DB_utils.py` 設定**資料庫名稱** (DB_NAME)、**使用者名稱** (DB_USER)、**主機位置** (DB_HOST)及**通訊埠** (DB_PORT)

先執行 `server.py` 啟動伺服器：

```bash
python .\server.py
```

再透過 `client.py` 向伺服器連線：

```bash
python .\client.py
```

## 技術細節

- 使用 Socket 建立 client-server 連線，搭配 Multithreading 達成多人同時連線

- 資料庫使用 PostgreSQL，使用套件 Psycopg2 對資料庫進行操作

- **交易管理**：針對 Admin 的【批次匯入課程資訊】的功能，為實現交易管理，在寫入的過程中如果出現違反資料表限制的情況，新增的動作會立即停止，而系統將 ROLLBACK 回滾該次交易，取消之前的所有資料庫異動。反之若匯入過程順利完成，系統將在最後 COMMIT 提交交易。

- **併行控制**：針對【新增 playlist】功能，
  - 可參考 `./DB_util.py` 中的 `create_playlist()`。

## 程式說明

1. **`./server.py`**
   - 包含伺服器端的主要功能。
   - 在連接資料庫後，透過 socket 建立監聽服務，接收來自客戶端的連線請求。
   - 每當接收到一個客戶端連線，會啟動一個獨立的執行緒（thread）處理該連線，確保伺服器能並行處理多個客戶端。
2. **`./client.py`**
   - 包含客戶端的主要功能。
   - 持續從伺服器接收訊息並顯示於終端機。
   - 當訊息包含特定標籤（tag）時，根據標籤執行對應的操作，例如讀取使用者輸入、解析 CSV 檔案、關閉 socket 連線並結束程式。
3. **`./DB_utils.py`**
   - 封裝與資料庫相關的功能，包含資料庫連線管理與查詢操作。
4. **`./action` 資料夾**
   - 每項執行動作被實作為一個類別，繼承抽象類別 `Action`，並實作其核心方法 `exec()`。
   - 此架構讓程式具備高度擴展性，開發者可透過新增 action 類別輕鬆增加新功能。
5. **`./role` 資料夾**
   - 為支援未來擴展更多角色類型（如 User 和 Admin 之外的角色），將角色實作為類別，並繼承基底類別 `Role`。
   - 每個角色類別共享基底類別的通用功能，並可擴展定義角色特有的行為與權限。

## 開發環境

- Mac OS

- Python: 3.10.9

  - psycopg2: 2.9.10
  - pandas: 2.2.2
  - tabulate: 0.9.0

- PostgreSQL: 16.4


